<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="../styles/common.css" />
    <link rel="stylesheet" href="../styles/region-selector.css" />
  </head>
  <body>
    <div class="tip">ğŸ–±ï¸ æ‹–åŠ¨é¼ æ ‡é€‰æ‹©ç¿»è¯‘åŒºåŸŸ | ESC å–æ¶ˆ</div>
    <div class="selection-box dashed-border" id="selectionBox"></div>
    <div class="size-info" id="sizeInfo"></div>

    <script>
      const { ipcRenderer } = require("electron");

      const selectionBox = document.getElementById("selectionBox");
      const sizeInfo = document.getElementById("sizeInfo");

      let isSelecting = false;
      let startX = 0;
      let startY = 0;

      let screenStartX = 0;
      let screenStartY = 0;

      document.addEventListener("mousedown", (e) => {
        isSelecting = true;
        startX = e.clientX;
        startY = e.clientY;
        screenStartX = e.screenX;
        screenStartY = e.screenY;
        selectionBox.style.display = "block";
      });

      document.addEventListener("mousemove", (e) => {
        if (!isSelecting) return;

        const currentX = e.clientX;
        const currentY = e.clientY;

        const left = Math.min(startX, currentX);
        const top = Math.min(startY, currentY);
        const width = Math.abs(currentX - startX);
        const height = Math.abs(currentY - startY);

        selectionBox.style.left = left + "px";
        selectionBox.style.top = top + "px";
        selectionBox.style.width = width + "px";
        selectionBox.style.height = height + "px";

        sizeInfo.style.left = left + 5 + "px";
        sizeInfo.style.top = top - 35 + "px";
        sizeInfo.style.display = "block";
        sizeInfo.textContent = `${width} Ã— ${height}`;
      });

      document.addEventListener("mouseup", (e) => {
        if (!isSelecting) return;

        isSelecting = false;

        const screenCurrentX = e.screenX;
        const screenCurrentY = e.screenY;

        const screenLeft = Math.min(screenStartX, screenCurrentX);
        const screenTop = Math.min(screenStartY, screenCurrentY);
        const width = Math.abs(screenCurrentX - screenStartX);
        const height = Math.abs(screenCurrentY - screenStartY);

        if (width > 10 && height > 10) {
          ipcRenderer.send("region-selected", {
            x: screenLeft,
            y: screenTop,
            width,
            height,
          });
        } else {
          ipcRenderer.send("cancel-selection");
        }
      });

      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") {
          ipcRenderer.send("cancel-selection");
        }
      });
    </script>
  </body>
</html>
